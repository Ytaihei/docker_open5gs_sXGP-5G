# S1-N2 Converter 未実装機能一覧

本ドキュメントは、卒業論文第4章のファクトチェックを通じて明らかになった、S1-N2変換ゲートウェイ（sXGP-5G）の未実装機能を整理したものである。

## 1. C-Plane変換

### 1.1 S1 Setup関連
| 機能 | 現状 | 理想的な実装 | 優先度 |
|------|------|-------------|--------|
| gNB-ID生成 | 固定値を使用 | eNB-IDから動的に生成 | 低 |

### 1.2 NAS変換関連
| 機能 | 現状 | 理想的な実装 | 優先度 |
|------|------|-------------|--------|
| NAS変換失敗時 | 原文NASを透過転送（フォールバック） | 完全な変換または明示的なエラー返却 | 中 |

### 1.3 PDU Session関連
| 機能 | 現状 | 理想的な実装 | 優先度 |
|------|------|-------------|--------|
| S1N2 TEID割り当て | 固定/ダミー値（例: `0x00000001`, `0x12345678`） | 動的割り当て（UEごとにユニーク、衝突しない） | 高 |
| APN/DNN取得 | 環境変数（デフォルト: `internet`） | Attach RequestのESM情報から解析 | 中 |

## 2. U-Plane変換

### 2.1 TEIDマッピング
| 機能 | 現状 | 理想的な実装 | 優先度 |
|------|------|-------------|--------|
| Downlink TEID書き換え | Transparent Proxy（書き換えなし） | 完全なゲートウェイとしてTEIDを書き換え | 低 |

## 3. 認証・暗号化

### 3.1 暗号化アルゴリズム
| 機能 | 現状 | 理想的な実装 | 優先度 |
|------|------|-------------|--------|
| NEA0/EEA0 (null) | 実装済み | - | - |
| NEA2/EEA2 (AES-CTR) | 実装済み | - | - |
| NIA2/EIA2 (AES-CMAC) | 実装済み | - | - |
| NEA1/EEA1 (SNOW 3G) | **未実装** | 実装 | 低 |
| NEA3/EEA3 (ZUC) | **未実装** | 実装 | 低 |
| NIA1/EIA1 (SNOW 3G) | **未実装** | 実装 | 低 |
| NIA3/EIA3 (ZUC) | **未実装** | 実装 | 低 |

### 3.2 NASセキュリティ処理
| 機能 | 現状 | 理想的な実装 | 優先度 |
|------|------|-------------|--------|
| 5G UL暗号化 (KNASenc(5G)) | **未実装**（完全性保護のみ） | 暗号化を適用 | 中 |
| 5G NAS DL COUNT管理 | **部分実装**（SQNから算出するが、履歴カウンタ保持が未実装） | DL COUNTを状態として保持し一貫管理 | 中 |

### 3.3 鍵管理
| 機能 | 現状 | 理想的な実装 | 優先度 |
|------|------|-------------|--------|
| Ki/OPc管理 | 設定ファイル（auth_keys.yaml）から読み込み | N26連携またはAAA連携 | 高（商用化時） |

## 4. コンテキスト管理・タイマ

### 4.1 タイマ機構
| 機能 | 現状 | 理想的な実装 | 優先度 |
|------|------|-------------|--------|
| T_ctx（コンテキスト保持） | **未実装** | UEコンテキストの期限切れ自動破棄 | 中 |
| T_gtp（TEID通知待ち） | **未実装** | PDUセッション確立タイムアウト | 中 |
| T_proc（手順待ち合わせ） | **未実装** | C-Plane往復のタイムアウト | 中 |

**現状の時間管理**:
- TEIDマッピング期限切れ: 1時間未使用でクリーンアップ（5分間隔）
- TAUガード: 60秒
- ICS重複抑止: 10秒

## 5. QoS処理

### 5.1 QCI/5QIマッピング
| 機能 | 現状 | 理想的な実装 | 優先度 |
|------|------|-------------|--------|
| Downlink QCI設定 | 固定値（QCI=9） | 5G側から通知された5QIに基づいて動的設定 | 中 |
| Uplink 5QI設定 | 1〜9は同値、それ以外は9フォールバック | 完全なマッピングテーブル | 低 |

### 5.2 ビットレート変換
| 機能 | 現状 | 理想的な実装 | 優先度 |
|------|------|-------------|--------|
| GFBR/MFBR → GBR/MBR | **未実装** | Flow単位からBearer単位への変換 | 中 |
| UE-AMBR | 固定値（1Mbps） | 動的設定 | 中 |

## 6. Network Slicing

| 機能 | 現状 | 理想的な実装 | 優先度 |
|------|------|-------------|--------|
| S-NSSAI/AllowedNSSAI | 固定値（SST=1）で補完 | 動的マッピングまたはポリシーベース選択 | 低 |

## 7. エラー処理・ロギング

### 7.1 エラー応答
| 機能 | 現状 | 理想的な実装 | 優先度 |
|------|------|-------------|--------|
| causeコード付き応答生成 | 原則ログ出力＋破棄 | S1AP/NGAP Causeを設定して拒否応答を返却 | 中 |
| ErrorIndication/UEContextRelease | 受信したものを変換・転送（橋渡し） | 変換器自身からも生成・送信 | 低 |

### 7.2 ロギング
| 機能 | 現状 | 理想的な実装 | 優先度 |
|------|------|-------------|--------|
| ログ形式 | printf/log_info/log_error混在（非統一） | 構造化ログ（JSON等） | 低 |

## 8. その他

| 機能 | 現状 | 理想的な実装 | 優先度 |
|------|------|-------------|--------|
| 複数UE同時接続 | TEIDが固定/ダミーになりやすく衝突しやすい | 動的TEID割り当てにより複数UE対応 | 高 |
| Handover | **未実装** | S1/X2ハンドオーバーのサポート | 低 |
| Paging | **未実装** | Idle状態UEへのページング | 低 |

---

## 優先度の判断基準

- **高**: 基本的な動作に影響する、または商用化に必須
- **中**: 機能拡張として望ましい、またはエッジケースで問題となる
- **低**: 完全性のために望ましいが、検証目的では不要

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2025-12-14 | 初版作成（卒論第4章ファクトチェック結果に基づく） |
